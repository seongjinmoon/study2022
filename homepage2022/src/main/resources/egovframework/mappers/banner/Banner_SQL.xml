<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.let.banner.service.impl.BannerMapper">

	<select id="selectBannerList" resultType="egovMap">
		SELECT 
			BANNER_ID             
			, BANNER_NM          
			, BANNER_IMAGE       
			, BANNER_IMAGE_FILE            
			, BANNER_DC            
			, NTCE_BGNDE          
			, NTCE_ENDDE          
			, LIKN_URL
			, POPUP_TRGET_AT       
			, FRST_REGIST_PNTTM    
			, FRST_REGISTER_ID     
			, LAST_UPDT_PNTTM
			, LAST_UPDUSR_ID
		FROM banner
		
		<include refid="selectBannerListWhere"></include>
		
		ORDER BY FRST_REGIST_PNTTM DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBannerListCnt" resultType="java.lang.Integer">
		SELECT 
			COUNT(*) CNT
		FROM banner
		<include refid="selectBannerListWhere"></include>
	</select>
	
	<sql id="selectBannerListWhere">
		<where>
			USE_AT = 'Y'
			<if test='searchCondition != null and searchCondition != ""'>
				<choose>
					<when test='searchCondition == "0"'>
						AND BANNER_NM LIKE CONCAT('%', #{searchKeyword}, '%')
					</when>
					<when test='searchCondition == "1"'>
						AND BANNER_DC LIKE CONCAT('%', #{searchKeyword}, '%')
					</when>
				</choose>
			</if>
		</where>
	</sql>
	
	<insert id="insertBanner" parameterType="egovframework.let.banner.service.BannerVO">
		INSERT INTO banner(
			BANNER_ID
			, BANNER_NM
			, BANNER_IMAGE
			, BANNER_IMAGE_FILE
			, BANNER_DC
			, NTCE_BGNDE
			, NTCE_ENDDE
			, LIKN_URL
			, POPUP_TRGET_AT
			, USE_AT
			, FRST_REGIST_PNTTM
			, FRST_REGISTER_ID
			, LAST_UPDT_PNTTM
			, LAST_UPDUSR_ID
		)VALUES(
			#{bannerId}
			, #{bannerNm}
			, #{bannerImage}
			, #{bannerImageFile}
			, #{bannerDc}
			, #{ntceBgnde}
			, #{ntceEndde}
			, #{liknUrl}
			, #{popupTrgetAt}
			, 'Y'
			, NOW()
			, #{userId}
			, NOW()
			, #{userId} 
		)
	</insert>
	
	<select id="selectBanner" resultType="egovMap">
		SELECT 
			BANNER_ID             
			, BANNER_NM          
			, BANNER_IMAGE       
			, BANNER_IMAGE_FILE            
			, BANNER_DC            
			, NTCE_BGNDE          
			, NTCE_ENDDE          
			, LIKN_URL
			, POPUP_TRGET_AT       
			, FRST_REGIST_PNTTM    
			, FRST_REGISTER_ID     
			, LAST_UPDT_PNTTM
			, LAST_UPDUSR_ID
		FROM banner
		WHERE BANNER_ID = #{bannerId}
	</select>
	
	<update id="updateBanner" parameterType="egovframework.let.banner.service.BannerVO">
		UPDATE banner SET
			BANNER_ID = #{bannerId}
			, BANNER_NM = #{bannerNm}
			, BANNER_IMAGE = #{bannerImage}
			, BANNER_IMAGE_FILE = #{bannerImageFile}
			, BANNER_DC = #{bannerDc}
			, NTCE_BGNDE = #{ntceBgnde}
			, NTCE_ENDDE = #{ntceEndde}
			, LIKN_URL = #{liknUrl}
			, POPUP_TRGET_AT = #{popupTrgetAt}
			, LAST_UPDT_PNTTM  = NOW()
			, LAST_UPDUSR_ID  = #{userId}
		WHERE BANNER_ID = #{bannerId}
	</update>
	
	<delete id="deleteBanner" parameterType="egovframework.let.banner.service.BannerVO">
		UPDATE banner SET
			USE_AT = 'N'
			, LAST_UPDT_PNTTM  = NOW()
			, LAST_UPDUSR_ID  = #{userId}
		WHERE BANNER_ID = #{bannerId}
	</delete>
	
</mapper>